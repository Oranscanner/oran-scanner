<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f1117"/>
<title>Oran-SCAN711s</title>
<style>
  *, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
  :root {
    --bg:#0f1117; --surface:#1a1d27; --border:#2e3345;
    --accent:#3a86ff; --accentLight:#dbeafe; /* Blue Branding */
    --text:#e8eaf0; --muted:#7a7f95; --danger:#ff5c5c;
    --yellow:#ffff00; --successBg:#ffffff; --successText:#000000;
  }
  html, body { height: 100%; background:var(--bg); color:var(--text); font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
  
  /* Fixed Top Section */
  .header-fixed { position: fixed; top: 0; left: 0; right: 0; background: var(--bg); padding: 10px 15px; z-index: 1000; border-bottom: 1px solid var(--border); }
  
  h1 { font-size: 22px; text-align: center; margin-bottom: 8px; color: var(--accent); font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
  
  .cs-input-wrap { display: flex; align-items: center; justify-content: center; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 5px; margin-bottom: 8px; }
  .cs-input-wrap input { background: transparent; border: none; color: var(--yellow); width: 100px; outline: none; font-size: 20px; font-weight: bold; text-align: center; }
  
  .stat-mini { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px; text-align: center; margin-bottom: 8px; }
  .stat-val { font-size: 20px; font-weight: bold; color: var(--accent); }

  /* Light Blue Camera Box */
  .btn-cam { padding:12px; width:100%; margin-bottom:8px; background:#add8e6; color:#00008b; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
  
  /* Scrolling List Area */
  .scroll-area { margin-top: 260px; height: calc(100vh - 410px); overflow-y: auto; padding: 0 15px; scroll-behavior: smooth; }
  
  .tbl-row { display:grid; grid-template-columns:30px 1fr 1.5fr 30px; gap:8px; align-items:center; padding:6px; margin-bottom: 5px; border-radius:6px; background:rgba(255,255,255,0.05); }
  
  /* High Contrast Row Style */
  .complete-row input { background: var(--successBg) !important; color: var(--successText) !important; border-color: #ccc !important; }

  .tbl-row input { background:var(--surface); border:1px solid var(--border); border-radius:6px; padding:10px; color:white; font-size: 16px; width:100%; }
  .error-highlight { border: 2px solid var(--danger) !important; background: rgba(255, 92, 92, 0.2) !important; }

  .actions-fixed { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg); padding: 15px; display: flex; gap: 10px; border-top: 1px solid var(--border); z-index: 1000; }
  .btn-export { background: #217346; color: white; padding: 15px; flex: 1.5; border-radius: 8px; border: none; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px; }
  
  /* Blue Jump Arrow */
  .jump-btn { position: fixed; bottom: 180px; right: 20px; width: 55px; height: 55px; background: var(--accent); color: white; border-radius: 50%; display: none; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.5); font-size: 24px; align-items:center; justify-content:center; border: none; }
  
  #msg { text-align: center; font-size: 13px; color: var(--danger); font-weight: bold; height: 20px; margin-bottom: 5px; transition: opacity 0.5s; }
  .flash-red { background-color: #660000 !important; }
</style>
</head>
<body id="mainBody">

<div class="header-fixed">
  <h1>Oran-SCAN711s</h1> <div class="cs-input-wrap"><input type="tel" id="csInput" maxlength="5" placeholder="CS#" oninput="saveCS()"></div>
  <div class="stat-mini"><span id="statFilled" class="stat-val">0</span> <span style="font-size: 14px; color: var(--muted);">Unique Zones</span></div> <div id="msg"></div>
  <button class="btn-cam" id="camBtn">▶ START CAMERA</button> </div>

<div class="scroll-area" id="scrollContainer" onscroll="toggleJumpBtn()"> <div id="interactive" style="display:none; width:100%; height:200px; margin-bottom:10px;"></div>
  <div class="tbl-body" id="tableBody"></div>
</div>

<div class="actions-fixed">
  <button class="btn-export" id="exportBtn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.8,20H14L12,16.6L10,20H8.2L11.1,15.5L8.2,11H10L12,14.4L14,11H15.8L12.9,15.5L15.8,20M13,9V3.5L18.5,9H13Z"/></svg>
    EXPORT EXCEL </button>
</div>

<button class="btn jump-btn" id="jumpBtn" onclick="scrollToTop()">↑</button> <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
const TOTAL = 50; // [cite: 27]
let rows = JSON.parse(localStorage.getItem('scannerRows')) || Array.from({length:TOTAL}, () => ({zone:'', serial:''}));

function saveCS() { localStorage.setItem('csNumber', document.getElementById('csInput').value); }
document.getElementById('csInput').value = localStorage.getItem('csNumber') || '';

function playError() {
    document.getElementById('mainBody').classList.add('flash-red');
    setTimeout(() => document.getElementById('mainBody').classList.remove('flash-red'), 300);
}

function showMsg(text) {
    const m = document.getElementById('msg');
    m.innerText = text;
    setTimeout(() => { m.innerText = ""; }, 4000); // [cite: 22]
}

function renderTable() {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    rows.forEach((r, i) => {
        const isComplete = r.zone.length === 3 && r.serial.length === 10; // 
        const div = document.createElement('div');
        div.className = `tbl-row ${isComplete ? 'complete-row' : ''}`;
        div.innerHTML = `
            <span style="font-size:10px; color:var(--muted)">${i+1}</span>
            <input type="tel" id="zone-${i}" maxlength="3" placeholder="000" value="${r.zone}" 
                   onblur="validateZone(${i}, this.value)">
            <input type="tel" id="ser-${i}" maxlength="10" placeholder="Serial" value="${r.serial}" 
                   onblur="validateSerial(${i}, this.value)">
            <button onclick="clearRow(${i})" style="color:var(--danger); background:none; border:none; font-size:20px;">×</button>
        `;
        tbody.appendChild(div);
    });
    // Count zones that have any data [cite: 15]
    document.getElementById('statFilled').innerText = rows.filter(r => r.zone !== '').length;
    localStorage.setItem('scannerRows', JSON.stringify(rows));
}

function validateZone(idx, val) {
    if (val === "") return;
    const isDup = rows.some((r, i) => r.zone === val && i !== idx);
    if (val.length !== 3 || isDup) { // [cite: 3]
        document.getElementById(`zone-${idx}`).classList.add('error-highlight');
        showMsg(isDup ? "❌ DUPLICATE ZONE" : "⚠️ ZONE MUST BE 3 DIGITS");
        playError();
        document.getElementById(`zone-${idx}`).focus(); // [cite: 13]
    } else {
        document.getElementById(`zone-${idx}`).classList.remove('error-highlight');
        rows[idx].zone = val;
        renderTable();
    }
}

function validateSerial(idx, val) {
    if (val === "") return;
    const isDup = rows.some((r, i) => r.serial === val && i !== idx);
    if (val.length !== 10 || isDup) { // [cite: 4]
        document.getElementById(`ser-${idx}`).classList.add('error-highlight');
        showMsg(isDup ? "❌ DUPLICATE SERIAL" : "⚠️ SERIAL MUST BE 10 DIGITS");
        playError();
        document.getElementById(`ser-${idx}`).focus(); // [cite: 13]
    } else {
        document.getElementById(`ser-${idx}`).classList.remove('error-highlight');
        rows[idx].serial = val;
        renderTable();
    }
}

function clearRow(i) { rows[i] = {zone:'', serial:''}; renderTable(); }

function toggleJumpBtn() {
    const btn = document.getElementById('jumpBtn');
    btn.style.display = document.getElementById('scrollContainer').scrollTop > 100 ? 'flex' : 'none'; // [cite: 11]
}

function scrollToTop() {
    document.getElementById('scrollContainer').scrollTo({top: 0, behavior: 'smooth'}); // [cite: 9]
}

document.getElementById('exportBtn').addEventListener('click', () => {
    // Check for serials without zones [cite: 22]
    const errorIdx = rows.findIndex(r => r.serial !== "" && r.zone === "");
    if (errorIdx !== -1) {
        document.getElementById(`zone-${errorIdx}`).classList.add('error-highlight');
        showMsg("❌ MISSING ZONE FOR SERIAL");
        playError();
        document.getElementById(`zone-${errorIdx}`).scrollIntoView();
        return;
    }

    const data = [["Zone", "Serial"], ...rows.filter(r => r.zone !== "").map(r => [r.zone, r.serial])]; // 
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Inventory");
    XLSX.writeFile(wb, "Oran-SCAN711s.xlsx");
});

renderTable();
</script>
</body>
</html>
